// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}


// Admin user for authentication only
model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations for tracking who created entries
  createdOrders       Order[]            @relation("OrderCreator")
  createdTransactions MoneyTransaction[] @relation("TransactionCreator")
  createdTodos        Todo[]             @relation("TodoCreator")
  createdEvents       CalendarEvent[]    @relation("EventCreator")
  createdLinks        CompanyLink[]      @relation("LinkCreator")
  createdNotes        Note[]             @relation("NoteCreator")
  assignedTodos       TodoAssignee[]     // Todos assigned to this admin user
}

// Company with total balance
model Company {
  id           String   @id @default(cuid())
  name         String
  balance      Float    @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  employees    Employee[]
  transactions MoneyTransaction[]
  orders       Order[]
  links        CompanyLink[]
}

// Employees belong to company
model Employee {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  phone     String?
  position  String?
  companyId String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  company       Company        @relation(fields: [companyId], references: [id], onDelete: Cascade)
  assignedTodos TodoAssignee[] // Todos assigned to this employee
}

// Company money transactions (credit/debit)
model MoneyTransaction {
  id          String   @id @default(cuid())
  amount      Float
  type        String   // "credit" or "debit"
  description String?
  orderNumber String?  // Optional order number reference
  companyId   String
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now()) @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy User?   @relation("TransactionCreator", fields: [createdById], references: [id])
}

model Order {
  id          String   @id @default(cuid())
  title       String
  description String?
  orderNumber String?  // Optional order number/reference
  amount      Float?   // Optional order amount (read-only display)
  status      String   @default("active") // active, on_hold, in_meeting, completed
  companyId   String
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy User?   @relation("OrderCreator", fields: [createdById], references: [id])
}

model Todo {
  id          String   @id @default(cuid())
  title       String
  description String?
  status      String   @default("pending") // pending, in_progress, completed
  priority    String   @default("medium") // low, medium, high
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  createdBy User?          @relation("TodoCreator", fields: [createdById], references: [id])
  assignees TodoAssignee[]
}

// Join table for Todo assignees - supports both Users and Employees
model TodoAssignee {
  id         String   @id @default(cuid())
  todoId     String
  userId     String?  // Admin user assignee
  employeeId String?  // Employee assignee
  assignedAt DateTime @default(now())

  todo     Todo      @relation(fields: [todoId], references: [id], onDelete: Cascade)
  user     User?     @relation(fields: [userId], references: [id], onDelete: Cascade)
  employee Employee? @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([todoId, userId])
  @@unique([todoId, employeeId])
}

// Calendar events/notes
model CalendarEvent {
  id          String   @id @default(cuid())
  title       String
  description String?
  date        DateTime
  color       String   @default("#3b82f6")
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  createdBy User? @relation("EventCreator", fields: [createdById], references: [id])
}

// Company links and resources
model CompanyLink {
  id          String   @id @default(cuid())
  companyId   String
  title       String
  url         String
  category    String   @default("other") // website, social, document, other
  notes       String?
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  createdBy User?   @relation("LinkCreator", fields: [createdById], references: [id])
}

// Notes - visible to all admins
model Note {
  id          String   @id @default(cuid())
  title       String
  content     String   @db.Text
  color       String   @default("indigo") // indigo, rose, emerald, amber, sky, violet
  isPinned    Boolean  @default(false)
  createdById String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  createdBy User? @relation("NoteCreator", fields: [createdById], references: [id])
}
